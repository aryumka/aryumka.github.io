{"version":3,"file":"component---src-templates-post-tsx-content-file-path-src-posts-2024-05-12-kafka-axon-eventsourcing-mdx-06a2e73f0ad0e3b9acac.js","mappings":"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","sources":["webpack://aryumka.me/./src/posts/2024-05-12-kafka-axon-eventsourcing.mdx","webpack://aryumka.me/./src/templates/post.tsx"],"sourcesContent":["/*@jsxRuntime classic @jsx React.createElement @jsxFrag React.Fragment*/\nimport {useMDXComponents as _provideComponents} from \"@mdx-js/react\";\nimport React from \"react\";\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h2: \"h2\",\n    a: \"a\",\n    p: \"p\",\n    ol: \"ol\",\n    li: \"li\",\n    h3: \"h3\",\n    span: \"span\"\n  }, _provideComponents(), props.components);\n  return React.createElement(React.Fragment, null, React.createElement(_components.h2, {\n    id: \"이벤트-소싱\"\n  }, React.createElement(_components.a, {\n    href: \"#이벤트-소싱\"\n  }, \"이벤트 소싱\")), \"\\n\", React.createElement(_components.p, null, \"이벤트 소싱(Event Sourcing)은 도메인의 상태를 변경하는 모든 사건을 이벤트 스트림으로 저장하는 방식이다.\"), \"\\n\", React.createElement(_components.p, null, \"계좌 잔액 관리를 예로 들어보자.\"), \"\\n\", React.createElement(_components.p, null, \"전통적인 방식이라면 거래 내역을 따로 저장하고 해당 거래로 인해 발생한 잔액을 별도의 테이블에 저장할 것이다.\"), \"\\n\", React.createElement(_components.p, null, \"이벤트 소싱으로 계좌 잔액을 관리한다면 거래내역이 아니라 거래내역으로 인해 발생한 이벤트를 저장하게 된다.\\n현재 내 계좌에 남은 잔액은 수많은 거래(이벤트)들의 결과라고 볼 수 있다.\"), \"\\n\", React.createElement(_components.p, null, \"이 때 잔액을 계산하는 로직은 이벤트 스트림을 통해 계산할 수 있다.\"), \"\\n\", React.createElement(_components.h2, {\n    id: \"kafka를-이용한-이벤트-스트리밍\"\n  }, React.createElement(_components.a, {\n    href: \"#kafka를-이용한-이벤트-스트리밍\"\n  }, \"Kafka를 이용한 이벤트 스트리밍\")), \"\\n\", React.createElement(_components.p, null, \"이벤트는 다양한 방법으로 처리할 수 있다.\"), \"\\n\", React.createElement(_components.p, null, \"만약 이벤트를 발동하는 JVM과 이벤트를 처리하는 JVM이 다른 분산 환경이라면 브로커등의 미들웨어를 도입하여 안정적이고 효율적인 구현이 가능하다.\\nKafka는 분산형 스트리밍 플랫폼으로 특히 대용량 이벤트 스트림을 처리하는데 적합하다.\"), \"\\n\", React.createElement(_components.h2, {\n    id: \"axon-framework의-이벤트-처리-방식\"\n  }, React.createElement(_components.a, {\n    href: \"#axon-framework의-이벤트-처리-방식\"\n  }, \"Axon Framework의 이벤트 처리 방식\")), \"\\n\", React.createElement(_components.p, null, \"Axon Framework는 이벤트 소싱을 통한 CQRS(Command Query Responsibility Segregation)와 DDD(Domain Driven Design)을 지원하는 프레임워크이다.\"), \"\\n\", React.createElement(_components.p, null, \"Axon Framework는 이벤트를 처리하는 방식으로 크게 2가지 방식을 제공한다.\"), \"\\n\", React.createElement(_components.ol, null, \"\\n\", React.createElement(_components.li, null, \"Subscribing Event Processor - 순서가 보장되고 하나의 스레드에서 처리되어야 하는 작업에 적합하다. 연동된 미들웨어가 실패할 경우 이벤트 발행 자체가 실패하도록 강제한다. AMQP를 이용하는 경우 적절하다.\"), \"\\n\", React.createElement(_components.li, null, \"Tracking Event Processor - 여러 스레드에서 각 프로세서가 작업을 분배하여 병렬 작업할 수 있도록 한다. Kafka가 실패해도 이벤트 발행 자체에는 영향을 주지 않는다. Kafka를 이용할 때 적합하다.\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"예제에는 Tracking Event Processor를 사용하였다.\"), \"\\n\", React.createElement(_components.h2, {\n    id: \"예제\"\n  }, React.createElement(_components.a, {\n    href: \"#예제\"\n  }, \"예제\")), \"\\n\", React.createElement(_components.h3, {\n    id: \"0-docker-composeyml\"\n  }, React.createElement(_components.a, {\n    href: \"#0-docker-composeyml\"\n  }, \"0. docker-compose.yml\")), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.a, {\n    href: \"https://github.com/aryumka/axonkafka/blob/master/docker-compose.yaml\",\n    rel: \"nofollow noopener noreferrer\"\n  }, \"docker-compose.yaml\"), \"를 이용하여 Kafka와 Zookeeper를 설정한다.\"), \"\\n\", React.createElement(_components.h3, {\n    id: \"1-spring-boot-kafka-설정\"\n  }, React.createElement(_components.a, {\n    href: \"#1-spring-boot-kafka-설정\"\n  }, \"1. Spring Boot Kafka 설정\")), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"yaml\\\"><pre class=\\\"language-yaml\\\"><code class=\\\"language-yaml\\\"><span class=\\\"token key atrule\\\">axon</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token key atrule\\\">axonserver</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">enabled</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token boolean important\\\">false</span>\\n  <span class=\\\"token key atrule\\\">serializer</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">events</span><span class=\\\"token punctuation\\\">:</span> jackson\\n  <span class=\\\"token key atrule\\\">kafka</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">fetcher</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token key atrule\\\">enabled</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token boolean important\\\">true</span>\\n    <span class=\\\"token key atrule\\\">clientid</span><span class=\\\"token punctuation\\\">:</span> kafka<span class=\\\"token punctuation\\\">-</span>axon<span class=\\\"token punctuation\\\">-</span>example\\n    <span class=\\\"token key atrule\\\">producer</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token key atrule\\\">retries</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">0</span>\\n      <span class=\\\"token key atrule\\\">bootstrap-servers</span><span class=\\\"token punctuation\\\">:</span> localhost<span class=\\\"token punctuation\\\">:</span><span class=\\\"token number\\\">29092</span>\\n    <span class=\\\"token key atrule\\\">consumer</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token key atrule\\\">event-processor-mode</span><span class=\\\"token punctuation\\\">:</span> tracking\\n      <span class=\\\"token key atrule\\\">bootstrap-servers</span><span class=\\\"token punctuation\\\">:</span> localhost<span class=\\\"token punctuation\\\">:</span><span class=\\\"token number\\\">29092</span>\\n    <span class=\\\"token key atrule\\\">properties</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token key atrule\\\">security.protocol</span><span class=\\\"token punctuation\\\">:</span> PLAINTEXT</code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.h3, {\n    id: \"2-axon-설정\"\n  }, React.createElement(_components.a, {\n    href: \"#2-axon-설정\"\n  }, \"2. Axon 설정\")), \"\\n\", React.createElement(_components.p, null, \"기본적으로 JPA를 Event Store로 사용하고 Tracking Event Processor를 사용한다. DB는 H2를 사용한다.\\nToken Store는 InMemoryTokenStore를 사용한다. Token은 이벤트 스트림을 열 때 특정 이벤트의 위치를 특정하거나 특정한 위치에서 이벤트 스트림을 열기 위해 사용된다.\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"kotlin\\\"><pre class=\\\"language-kotlin\\\"><code class=\\\"language-kotlin\\\"><span class=\\\"token annotation builtin\\\">@SpringBootApplication</span>\\n<span class=\\\"token annotation builtin\\\">@EnableScheduling</span>\\n<span class=\\\"token keyword\\\">class</span> KafkaAxonApplication <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token annotation builtin\\\">@Bean</span>\\n    <span class=\\\"token keyword\\\">fun</span> <span class=\\\"token function\\\">tokenStore</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">InMemoryTokenStore</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n\\n<span class=\\\"token annotation builtin\\\">@Configuration</span>\\n<span class=\\\"token annotation builtin\\\">@ConditionalOnProperty</span><span class=\\\"token punctuation\\\">(</span>value <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token string-literal singleline\\\"><span class=\\\"token string\\\">\\\"axon.kafka.consumer.event-processor-mode\\\"</span></span><span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">,</span> havingValue <span class=\\\"token operator\\\">=</span> <span class=\\\"token string-literal singleline\\\"><span class=\\\"token string\\\">\\\"tracking\\\"</span></span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token keyword\\\">class</span> TrackingConfiguration <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token annotation builtin\\\">@Autowired</span>\\n    <span class=\\\"token keyword\\\">fun</span> <span class=\\\"token function\\\">configureStreamableKafkaSource</span><span class=\\\"token punctuation\\\">(</span>\\n        configurer<span class=\\\"token operator\\\">:</span> EventProcessingConfigurer<span class=\\\"token punctuation\\\">,</span>\\n        streamableKafkaMessageSource<span class=\\\"token operator\\\">:</span> StreamableKafkaMessageSource<span class=\\\"token operator\\\">&lt;</span>String<span class=\\\"token punctuation\\\">,</span> ByteArray<span class=\\\"token operator\\\">></span>\\n    <span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token comment\\\">// Tracking Event Processor의 이름을 KAFKA_GROUP으로 설정하고 StreamableKafkaMessageSource를 사용하여 등록</span>\\n        configurer<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">registerTrackingEventProcessor</span><span class=\\\"token punctuation\\\">(</span>KAFKA_GROUP<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span> streamableKafkaMessageSource <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre></div>\"\n    }\n  }), \"\\n\", React.createElement(_components.h3, {\n    id: \"3-bank-client\"\n  }, React.createElement(_components.a, {\n    href: \"#3-bank-client\"\n  }, \"3. Bank Client\")), \"\\n\", React.createElement(_components.p, null, \"1초에 한번씩 입금요청을 처리하도록 한다.\"), \"\\n\", React.createElement(_components.span, {\n    dangerouslySetInnerHTML: {\n      __html: \"<div class=\\\"gatsby-highlight\\\" data-language=\\\"kotlin\\\"><pre class=\\\"language-kotlin\\\"><code class=\\\"language-kotlin\\\"><span class=\\\"token annotation builtin\\\">@Component</span>\\n<span class=\\\"token keyword\\\">public</span> <span class=\\\"token keyword\\\">class</span> BankClient <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// ...</span>\\n    <span class=\\\"token annotation builtin\\\">@Scheduled</span><span class=\\\"token punctuation\\\">(</span>initialDelay <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">10_000</span><span class=\\\"token punctuation\\\">,</span> fixedDelay <span class=\\\"token operator\\\">=</span> <span class=\\\"token number\\\">100</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token keyword\\\">fun</span> <span class=\\\"token function\\\">deposit</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n        logger<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">debug</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token string-literal singleline\\\"><span class=\\\"token string\\\">\\\"depositing </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">$</span><span class=\\\"token expression\\\">amount</span></span><span class=\\\"token string\\\"> from account </span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">$</span><span class=\\\"token expression\\\">accountId</span></span><span class=\\\"token string\\\">\\\"</span></span> <span class=\\\"token punctuation\\\">}</span>\\n        commandGateway<span class=\\\"token punctuation\\\">.</span>send<span class=\\\"token operator\\\">&lt;</span>CompletableFuture<span class=\\\"token operator\\\">&lt;</span>String<span class=\\\"token operator\\\">></span><span class=\\\"token operator\\\">></span><span class=\\\"token punctuation\\\">(</span>\\n                <span class=\\\"token function\\\">DepositMoneyCommand</span><span class=\\\"token punctuation\\\">(</span>\\n                        bankAccountId <span class=\\\"token operator\\\">=</span> accountId<span class=\\\"token punctuation\\\">,</span>\\n                        amountOfMoney <span class=\\\"token operator\\\">=</span> amount<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">toLong</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n                <span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token punctuation\\\">)</span>\\n        amount <span class=\\\"token operator\\\">=</span> amount<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">inc</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span></code></pre></div>\"\n    }\n  }));\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? React.createElement(MDXLayout, props, React.createElement(_createMdxContent, props)) : _createMdxContent(props);\n}\nexport default MDXContent;\n","import GATSBY_COMPILED_MDX from \"/home/runner/work/aryumka.github.io/aryumka.github.io/src/posts/2024-05-12-kafka-axon-eventsourcing.mdx\";\nimport _styled from \"@emotion/styled/base\";\nfunction _EMOTION_STRINGIFIED_CSS_ERROR__() {\n  return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\";\n}\nimport React from 'react';\nimport DefaultTemplate from '@templates/default';\nimport SEO from '@components/SEO';\nimport dayjs from 'dayjs';\nimport PostFooter from '@components/PostFooter';\nimport RelatedPost from '@components/RelatedPost';\nimport TableOfContents from '@components/TableOfContents';\nimport {Helmet} from 'react-helmet';\nimport $ from 'jquery';\nimport {useEffect} from 'react';\nimport {useState} from 'react';\nimport Series from '@components/Series';\nimport {jsx as ___EmotionJSX} from \"@emotion/react\";\ndayjs.extend(require('dayjs/plugin/localizedFormat'));\nconst PostTemplate = _ref => {\n  let {data, location, pageContext, children} = _ref;\n  const {tableOfContents, fields, frontmatter, excerpt} = data.mdx;\n  const {series} = pageContext;\n  const author = 'Lee Sun-Hyoup';\n  const date = dayjs(fields.date).locale('ko').format();\n  const applicationLdJson = {\n    headline: frontmatter.title,\n    dateModified: date,\n    datePublished: date,\n    image: `${location.href}${frontmatter.image}`,\n    mainEntityOfPage: {\n      '@type': 'WebPage',\n      '@id': location.href\n    },\n    author: {\n      '@type': 'Person',\n      name: author\n    },\n    url: location.href,\n    description: excerpt,\n    '@type': 'BlogPosting',\n    '@context': 'https://schema.org'\n  };\n  useEffect(() => {\n    if (typeof document === undefined) return;\n    $(function () {\n      $('.post-container a[data-footnote-ref]').each((_, item) => {\n        var _$$attr;\n        const href = (_$$attr = $(item).attr('href')) === null || _$$attr === void 0 ? void 0 : _$$attr.slice(1);\n        const text = $('#' + href).text().replace('↩', '');\n        $(item).attr('data-tooltip', text);\n      });\n    });\n  }, []);\n  const {0: posts, 1: setPosts} = useState();\n  useEffect(() => {\n    setPosts(data.allMdx.edges.filter(item => item.node.fields.slug !== fields.slug).sort(() => Math.random() - 0.5).slice(0, 6));\n  }, []);\n  const draft = frontmatter.draft && process.env.NODE_ENV !== 'development';\n  return ___EmotionJSX(DefaultTemplate, null, ___EmotionJSX(SEO, {\n    title: frontmatter.title,\n    description: excerpt,\n    meta: [{\n      name: `article:published_time`,\n      content: dayjs(fields.date).locale('ko').format()\n    }, {\n      name: `image`,\n      content: `https://aryumka.me${frontmatter.image}`\n    }, {\n      property: `og:image`,\n      content: `https://aryumka.me${frontmatter.image}`\n    }, {\n      property: `og:image:secure_url`,\n      content: `https://aryumka.me${frontmatter.image}`\n    }]\n  }), ___EmotionJSX(Helmet, null, ___EmotionJSX(\"script\", {\n    type: \"application/ld+json\"\n  }, JSON.stringify(applicationLdJson))), ___EmotionJSX(\"h1\", {\n    className: \"post-title\"\n  }, frontmatter.title), ___EmotionJSX(\"span\", {\n    className: \"post-date\"\n  }, \"Written on \", dayjs(fields.date).locale('en').format('LL')), ___EmotionJSX(\"img\", {\n    src: frontmatter.image,\n    style: {\n      objectFit: 'cover',\n      maxHeight: 300,\n      width: '100%'\n    }\n  }), draft || tableOfContents.items && ___EmotionJSX(TableOfContents, {\n    items: tableOfContents.items\n  }), draft || (series === null || series === void 0 ? void 0 : series.items) && ___EmotionJSX(Series, {\n    title: series.title,\n    items: series.items,\n    currentItem: frontmatter.title\n  }), ___EmotionJSX(\"div\", {\n    className: \"post-content\"\n  }, draft ? ___EmotionJSX(NotYetPublished, null, \"Not yet published\") : children), ___EmotionJSX(PostFooter, {\n    tags: frontmatter.tags,\n    comment: frontmatter.comments\n  }), posts && ___EmotionJSX(RelatedPost, {\n    posts: posts,\n    current: fields.slug\n  }));\n};\nPostTemplate\nexport default function GatsbyMDXWrapper(props) {\n  return React.createElement(PostTemplate, props, React.createElement(GATSBY_COMPILED_MDX, props));\n}\nconst pageQuery = \"2550809065\";\nconst NotYetPublished = _styled(\"div\", process.env.NODE_ENV === \"production\" ? {\n  target: \"ezegrm70\"\n} : {\n  target: \"ezegrm70\",\n  label: \"NotYetPublished\"\n})(process.env.NODE_ENV === \"production\" ? {\n  name: \"xl5zip\",\n  styles: \"margin:16px 0;font-weight:bold;font-size:20px;text-align:center\"\n} : {\n  name: \"xl5zip\",\n  styles: \"margin:16px 0;font-weight:bold;font-size:20px;text-align:center\",\n  map: \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3JrL2FyeXVta2EuZ2l0aHViLmlvL2FyeXVta2EuZ2l0aHViLmlvL3NyYy90ZW1wbGF0ZXMvcG9zdC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBd0trQyIsImZpbGUiOiIvaG9tZS9ydW5uZXIvd29yay9hcnl1bWthLmdpdGh1Yi5pby9hcnl1bWthLmdpdGh1Yi5pby9zcmMvdGVtcGxhdGVzL3Bvc3QudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZUxheW91dEVmZmVjdCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IGdyYXBocWwsIFBhZ2VQcm9wcywgdXNlU3RhdGljUXVlcnkgfSBmcm9tICdnYXRzYnknO1xuaW1wb3J0IERlZmF1bHRUZW1wbGF0ZSBmcm9tICdAdGVtcGxhdGVzL2RlZmF1bHQnO1xuaW1wb3J0IFNFTyBmcm9tICdAY29tcG9uZW50cy9TRU8nO1xuaW1wb3J0IGRheWpzIGZyb20gJ2RheWpzJztcbmltcG9ydCBQb3N0Rm9vdGVyIGZyb20gJ0Bjb21wb25lbnRzL1Bvc3RGb290ZXInO1xuaW1wb3J0IFJlbGF0ZWRQb3N0IGZyb20gJ0Bjb21wb25lbnRzL1JlbGF0ZWRQb3N0JztcbmltcG9ydCBUYWJsZU9mQ29udGVudHMgZnJvbSAnQGNvbXBvbmVudHMvVGFibGVPZkNvbnRlbnRzJztcbmltcG9ydCB7IEhlbG1ldCB9IGZyb20gJ3JlYWN0LWhlbG1ldCc7XG5pbXBvcnQgJCBmcm9tICdqcXVlcnknO1xuaW1wb3J0IHsgdXNlRWZmZWN0IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgU2VyaWVzIGZyb20gJ0Bjb21wb25lbnRzL1Nlcmllcyc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ0BlbW90aW9uL3N0eWxlZCc7XG5cbmRheWpzLmV4dGVuZChyZXF1aXJlKCdkYXlqcy9wbHVnaW4vbG9jYWxpemVkRm9ybWF0JykpO1xuXG5jb25zdCBQb3N0VGVtcGxhdGUgPSAoeyBkYXRhLCBsb2NhdGlvbiwgcGFnZUNvbnRleHQsIGNoaWxkcmVuIH06IFBhZ2VQcm9wcykgPT4ge1xuICBjb25zdCB7IHRhYmxlT2ZDb250ZW50cywgZmllbGRzLCBmcm9udG1hdHRlciwgZXhjZXJwdCB9ID0gKGRhdGEgYXMgYW55KS5tZHg7XG5cbiAgY29uc3QgeyBzZXJpZXMgfSA9IHBhZ2VDb250ZXh0IGFzIGFueTtcblxuICBjb25zdCBhdXRob3IgPSAnTGVlIFN1bi1IeW91cCc7XG4gIGNvbnN0IGRhdGUgPSBkYXlqcyhmaWVsZHMuZGF0ZSkubG9jYWxlKCdrbycpLmZvcm1hdCgpO1xuICBjb25zdCBhcHBsaWNhdGlvbkxkSnNvbiA9IHtcbiAgICBoZWFkbGluZTogZnJvbnRtYXR0ZXIudGl0bGUsXG4gICAgZGF0ZU1vZGlmaWVkOiBkYXRlLFxuICAgIGRhdGVQdWJsaXNoZWQ6IGRhdGUsXG4gICAgaW1hZ2U6IGAke2xvY2F0aW9uLmhyZWZ9JHtmcm9udG1hdHRlci5pbWFnZX1gLFxuICAgIG1haW5FbnRpdHlPZlBhZ2U6IHtcbiAgICAgICdAdHlwZSc6ICdXZWJQYWdlJyxcbiAgICAgICdAaWQnOiBsb2NhdGlvbi5ocmVmXG4gICAgfSxcbiAgICBhdXRob3I6IHsgJ0B0eXBlJzogJ1BlcnNvbicsIG5hbWU6IGF1dGhvciB9LFxuICAgIHVybDogbG9jYXRpb24uaHJlZixcbiAgICBkZXNjcmlwdGlvbjogZXhjZXJwdCxcbiAgICAnQHR5cGUnOiAnQmxvZ1Bvc3RpbmcnLFxuICAgICdAY29udGV4dCc6ICdodHRwczovL3NjaGVtYS5vcmcnXG4gIH07XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSB1bmRlZmluZWQpIHJldHVybjtcblxuICAgICQoZnVuY3Rpb24gKCkge1xuICAgICAgJCgnLnBvc3QtY29udGFpbmVyIGFbZGF0YS1mb290bm90ZS1yZWZdJykuZWFjaCgoXywgaXRlbSkgPT4ge1xuICAgICAgICBjb25zdCBocmVmID0gJChpdGVtKS5hdHRyKCdocmVmJyk/LnNsaWNlKDEpO1xuICAgICAgICBjb25zdCB0ZXh0ID0gJCgnIycgKyBocmVmKVxuICAgICAgICAgIC50ZXh0KClcbiAgICAgICAgICAucmVwbGFjZSgn4oapJywgJycpO1xuXG4gICAgICAgICQoaXRlbSkuYXR0cignZGF0YS10b29sdGlwJywgdGV4dCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSwgW10pO1xuXG4gIGNvbnN0IFtwb3N0cywgc2V0UG9zdHNdID0gdXNlU3RhdGUoKTtcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBzZXRQb3N0cyhcbiAgICAgIChkYXRhIGFzIGFueSkuYWxsTWR4LmVkZ2VzXG4gICAgICAgIC5maWx0ZXIoKGl0ZW06IGFueSkgPT4gaXRlbS5ub2RlLmZpZWxkcy5zbHVnICE9PSBmaWVsZHMuc2x1ZylcbiAgICAgICAgLnNvcnQoKCkgPT4gTWF0aC5yYW5kb20oKSAtIDAuNSlcbiAgICAgICAgLnNsaWNlKDAsIDYpXG4gICAgKTtcbiAgfSwgW10pO1xuXG4gIGNvbnN0IGRyYWZ0ID0gZnJvbnRtYXR0ZXIuZHJhZnQgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdkZXZlbG9wbWVudCc7XG5cbiAgcmV0dXJuIChcbiAgICA8RGVmYXVsdFRlbXBsYXRlPlxuICAgICAgPFNFT1xuICAgICAgICB0aXRsZT17ZnJvbnRtYXR0ZXIudGl0bGV9XG4gICAgICAgIGRlc2NyaXB0aW9uPXtleGNlcnB0fVxuICAgICAgICBtZXRhPXtbXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogYGFydGljbGU6cHVibGlzaGVkX3RpbWVgLFxuICAgICAgICAgICAgY29udGVudDogZGF5anMoZmllbGRzLmRhdGUpLmxvY2FsZSgna28nKS5mb3JtYXQoKVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogYGltYWdlYCxcbiAgICAgICAgICAgIGNvbnRlbnQ6IGBodHRwczovL2FyeXVta2EubWUke2Zyb250bWF0dGVyLmltYWdlfWBcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHByb3BlcnR5OiBgb2c6aW1hZ2VgLFxuICAgICAgICAgICAgY29udGVudDogYGh0dHBzOi8vYXJ5dW1rYS5tZSR7ZnJvbnRtYXR0ZXIuaW1hZ2V9YFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgcHJvcGVydHk6IGBvZzppbWFnZTpzZWN1cmVfdXJsYCxcbiAgICAgICAgICAgIGNvbnRlbnQ6IGBodHRwczovL2FyeXVta2EubWUke2Zyb250bWF0dGVyLmltYWdlfWBcbiAgICAgICAgICB9XG4gICAgICAgIF19XG4gICAgICAvPlxuXG4gICAgICA8SGVsbWV0PlxuICAgICAgICA8c2NyaXB0IHR5cGU9XCJhcHBsaWNhdGlvbi9sZCtqc29uXCI+e0pTT04uc3RyaW5naWZ5KGFwcGxpY2F0aW9uTGRKc29uKX08L3NjcmlwdD5cbiAgICAgIDwvSGVsbWV0PlxuXG4gICAgICA8aDEgY2xhc3NOYW1lPVwicG9zdC10aXRsZVwiPntmcm9udG1hdHRlci50aXRsZX08L2gxPlxuXG4gICAgICA8c3BhbiBjbGFzc05hbWU9XCJwb3N0LWRhdGVcIj5Xcml0dGVuIG9uIHtkYXlqcyhmaWVsZHMuZGF0ZSkubG9jYWxlKCdlbicpLmZvcm1hdCgnTEwnKX08L3NwYW4+XG5cbiAgICAgIDxpbWcgc3JjPXtmcm9udG1hdHRlci5pbWFnZX0gc3R5bGU9e3sgb2JqZWN0Rml0OiAnY292ZXInLCBtYXhIZWlnaHQ6IDMwMCwgd2lkdGg6ICcxMDAlJyB9fSAvPlxuXG4gICAgICB7ZHJhZnQgfHwgKHRhYmxlT2ZDb250ZW50cy5pdGVtcyAmJiA8VGFibGVPZkNvbnRlbnRzIGl0ZW1zPXt0YWJsZU9mQ29udGVudHMuaXRlbXN9IC8+KX1cblxuICAgICAge2RyYWZ0IHx8XG4gICAgICAgIChzZXJpZXM/Lml0ZW1zICYmIChcbiAgICAgICAgICA8U2VyaWVzIHRpdGxlPXtzZXJpZXMudGl0bGV9IGl0ZW1zPXtzZXJpZXMuaXRlbXN9IGN1cnJlbnRJdGVtPXtmcm9udG1hdHRlci50aXRsZX0gLz5cbiAgICAgICAgKSl9XG5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwicG9zdC1jb250ZW50XCI+XG4gICAgICAgIHtkcmFmdCA/IDxOb3RZZXRQdWJsaXNoZWQ+Tm90IHlldCBwdWJsaXNoZWQ8L05vdFlldFB1Ymxpc2hlZD4gOiBjaGlsZHJlbn1cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8UG9zdEZvb3RlciB0YWdzPXtmcm9udG1hdHRlci50YWdzfSBjb21tZW50PXtmcm9udG1hdHRlci5jb21tZW50c30gLz5cblxuICAgICAge3Bvc3RzICYmIDxSZWxhdGVkUG9zdCBwb3N0cz17cG9zdHN9IGN1cnJlbnQ9e2ZpZWxkcy5zbHVnfSAvPn1cbiAgICA8L0RlZmF1bHRUZW1wbGF0ZT5cbiAgKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFBvc3RUZW1wbGF0ZTtcblxuZXhwb3J0IGNvbnN0IHBhZ2VRdWVyeSA9IGdyYXBocWxgXG4gIHF1ZXJ5IFBvc3RCeVNsdWcoJHNsdWc6IFN0cmluZyEpIHtcbiAgICBzaXRlIHtcbiAgICAgIHNpdGVNZXRhZGF0YSB7XG4gICAgICAgIHRpdGxlXG4gICAgICB9XG4gICAgfVxuICAgIG1keChmaWVsZHM6IHsgc2x1ZzogeyBlcTogJHNsdWcgfSB9KSB7XG4gICAgICBib2R5XG4gICAgICB0YWJsZU9mQ29udGVudHNcbiAgICAgIGV4Y2VycHRcbiAgICAgIGZpZWxkcyB7XG4gICAgICAgIHNsdWdcbiAgICAgICAgZGF0ZVxuICAgICAgfVxuICAgICAgZnJvbnRtYXR0ZXIge1xuICAgICAgICB0aXRsZVxuICAgICAgICBjYXRlZ29yaWVzXG4gICAgICAgIHRhZ3NcbiAgICAgICAgaW1hZ2VcbiAgICAgICAgY29tbWVudHNcbiAgICAgICAgZHJhZnRcbiAgICAgIH1cbiAgICB9XG4gICAgYWxsTWR4KFxuICAgICAgZmlsdGVyOiB7XG4gICAgICAgIGZpZWxkczogeyB0eXBlOiB7IGVxOiBcInBvc3RcIiB9IH1cbiAgICAgICAgZnJvbnRtYXR0ZXI6IHsgZHJhZnQ6IHsgbmU6IHRydWUgfSwgaGlkZTogeyBuZTogdHJ1ZSB9IH1cbiAgICAgIH1cbiAgICApIHtcbiAgICAgIGVkZ2VzIHtcbiAgICAgICAgbm9kZSB7XG4gICAgICAgICAgZmllbGRzIHtcbiAgICAgICAgICAgIGRhdGVcbiAgICAgICAgICAgIHNsdWdcbiAgICAgICAgICB9XG4gICAgICAgICAgZnJvbnRtYXR0ZXIge1xuICAgICAgICAgICAgdGl0bGVcbiAgICAgICAgICAgIGltYWdlXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5gO1xuXG5jb25zdCBOb3RZZXRQdWJsaXNoZWQgPSBzdHlsZWQuZGl2YFxuICBtYXJnaW46IDE2cHggMDtcbiAgZm9udC13ZWlnaHQ6IGJvbGQ7XG4gIGZvbnQtc2l6ZTogMjBweDtcbiAgdGV4dC1hbGlnbjogY2VudGVyO1xuYDtcbiJdfQ== */\",\n  toString: _EMOTION_STRINGIFIED_CSS_ERROR__\n});\n"],"names":["_createMdxContent","props","_components","Object","assign","h2","a","p","ol","li","h3","span","_provideComponents","components","React","id","href","rel","dangerouslySetInnerHTML","__html","wrapper","MDXLayout","dayjs","require","PostTemplate","_ref","data","location","pageContext","children","tableOfContents","fields","frontmatter","excerpt","mdx","series","date","locale","format","applicationLdJson","headline","title","dateModified","datePublished","image","mainEntityOfPage","author","name","url","description","useEffect","undefined","document","$","each","_","item","_$$attr","attr","slice","text","replace","posts","setPosts","useState","allMdx","edges","filter","node","slug","sort","Math","random","draft","process","___EmotionJSX","DefaultTemplate","SEO","meta","content","property","Helmet","type","JSON","stringify","className","src","style","objectFit","maxHeight","width","items","TableOfContents","Series","currentItem","NotYetPublished","PostFooter","tags","comment","comments","RelatedPost","current","GatsbyMDXWrapper","GATSBY_COMPILED_MDX","_styled","target","styles"],"sourceRoot":""}