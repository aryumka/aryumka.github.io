<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.13.4"/><meta name="theme-color" content="#ffffff"/><style data-href="/styles.0987e8fe2e778dba5c88.css" data-identity="gatsby-global-css">.command-line-prompt{border-right:1px solid #999;display:block;float:left;font-size:100%;letter-spacing:-1px;margin-right:1em;pointer-events:none;text-align:right;-webkit-user-select:none;user-select:none}.command-line-prompt>span:before{opacity:.7}.command-line-prompt>span[data-continuation-prompt]:before{content:attr(data-continuation-prompt)}.command-line span.token.output{opacity:.7}code[class*=language-],pre[class*=language-]{color:#5c6e74;direction:ltr;font-family:Source Code Pro,monospace;font-size:13px;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;text-shadow:none;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-]::mozselection,code[class*=language-]::selection,pre[class*=language-]::mozselection,pre[class*=language-]::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{background:#fff;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-]{background:#f9f2f4;border-radius:3px;color:#db4c69;padding:.25em .5em;position:relative;top:-1px;white-space:normal}.namespace{opacity:.7}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#999}.token.boolean,.token.constant,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#a67f59}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[data-line]{position:relative}pre[class*=language-]>code[class*=language-]{position:relative;z-index:1}.line-highlight{background:#f7efda;box-shadow:inset 5px 0 0 #87d8ff;left:0;line-height:inherit;margin-top:1em;padding-bottom:inherit;padding-left:0;padding-right:0;padding-top:inherit;pointer-events:none;position:absolute;right:0;white-space:pre;z-index:0}.command-line-prompt>span:before{color:#999;content:" ";display:block;padding-right:.8em}.command-line-prompt>span[data-user]:before{content:"[" attr(data-user) "@" attr(data-host) "] $"}.command-line-prompt>span[data-user=root]:before{content:"[" attr(data-user) "@" attr(data-host) "] #"}.command-line-prompt>span[data-prompt]:before{content:attr(data-prompt)}.gatsby-highlight pre{float:left;min-width:100%}.gatsby-highlight{background-color:#fff;border-radius:.3em;box-shadow:0 5px 20px rgba(0,0,0,.12);margin:32px auto;overflow:auto;padding:1em}.gatsby-highlight pre[class*=language-]{background-color:transparent;float:left;margin:0;min-width:100%;overflow:initial;padding:0}.gatsby-highlight-code-line{background:#fffbdd;border-left:.25em solid #87d8ff;display:block;margin-left:-1em;margin-right:-1em;padding-left:.75em;padding-right:1em}h1{border-bottom:1px solid #eee;font-size:2rem;padding-bottom:12px}h1 a{text-decoration:none}h2{border-bottom:1px solid #eee;font-size:1.6em;padding-bottom:8px}h3{font-size:1.3em}h3,h4{margin:8px 0}h4{font-size:1.2em}h1,h2,h3,h4,h5,h6{color:#454f5b;margin-top:48px}h1 a,h2 a,h3 a,h4 a,h5 a,h6 a{color:#454f5b!important;text-decoration:none}a{color:#454f5b;text-decoration:underline}a:hover{border-bottom:none;color:#000}img,video{border-radius:5px;height:auto;max-width:100%}blockquote{background-color:#eee;border-left:.25em solid #ccc;color:#454f5b;line-height:1.5;margin:10px 0;padding:8px 16px}hr{border-top:1px solid #ccc}.thumbnail-container{border-radius:8px;box-shadow:0 0 10px 2px rgba(0,0,0,.05);margin-bottom:25px;max-width:100%}.thumbnail-container a,.thumbnail-container img{display:block;object-fit:cover;width:100%}.post-container{line-height:1.75rem;position:relative}.post-content a{color:#5c6ac4;text-decoration:none}.post-content a:hover{text-decoration:underline}.post-content a.footnote-ref,.post-content a[data-footnote-ref]{color:#ff6f00}.post-content>p:first-letter{margin-left:.3em}.post-content ul{word-break:break-all}@media (max-width:30em){.post-content ul{list-style-position:outside;padding-left:24px}.post-content li>ul{list-style-position:outside;padding-left:12px}}sup{font-weight:400;position:relative;top:-.5em;vertical-align:top}.post-title{border:none;line-height:1.2;margin:0;padding:0}.post-date{color:#9a9a9a;display:block;font-family:Quattrocento Sans,sans-serif;font-size:.8rem;margin-bottom:1rem;margin-top:3px}@media (max-width:30rem){.posts h1{font-size:1.5rem}}figure{margin:24px 40px;text-align:center}@media (max-width:30em){figure{margin:24px 0}}figcaption{color:#637381;font-size:12px;text-align:center}.footnotes{border-top:1px solid #eee;font-size:12px;margin-top:48px}.footnotes ol{line-height:16px;padding-left:16px}.footnotes ol li{margin-top:8px;padding-left:4px}.footnotes ol p{margin:0}.footnotes ol li::marker{color:#ff6f00}.footnotes ol li .footnote-backref{margin-left:5px}table{border-collapse:collapse;margin-bottom:30px;width:100%}table,td,th{border:1px solid #888}td,th{padding:8px;text-align:left}.sharing-icons a{padding-right:10px}.fa-envelope{padding:5px;transition:.5s}.fa-envelope:hover{color:#f39c12}.fa-twitter{padding:5px;transition:color .5s}.fa-twitter:hover{color:#00aced}.fa-instagram{padding:5px;transition:color .5s}.fa-instagram:hover{color:#375989}.fa-github{padding:5px;transition:color .5s}.fa-github:hover{color:#343434}.fa-linkedin{padding:5px;transition:color .5s}.fa-linkedin:hover{color:#0073a4}.fa-facebook{padding:5px;transition:color .5s}.fa-facebook:hover{color:#3d5b99}.fa-google-plus{padding:5px;transition:color .5s}.fa-google-plus:hover{color:#e64a41}.fa-pinterest{padding:5px;transition:color .5s}.fa-pinterest:hover{color:#bd081c}.fa-medium{padding:5px;transition:color .5s}.fa-medium:hover{color:#00ab6c}.fa-codepen{padding:5px;transition:color .5s}.fa-codepen:hover{color:#000}.fa-rss-square{padding:5px;transition:color .5s}.fa-rss-square:hover{color:#f60}[data-tooltip]{position:relative}[data-tooltip]:after{word-wrap:break-word;background-color:#212b36;border-left:6px solid #ff6f00;border-radius:2px;box-shadow:1px 2px 6px rgba(0,0,0,.3);color:#fff;content:attr(data-tooltip);display:none;font-size:12px;left:10px;line-height:16px;overflow-wrap:break-word;padding:8px 10px;pointer-events:none;position:absolute;top:0;white-space:nowrap;word-break:break-all;z-index:1000}[data-tooltip]:focus:after,[data-tooltip]:hover:after{display:block}@media (max-width:30em){[data-tooltip]:focus:after,[data-tooltip]:hover:after{display:none}}.member-container{display:flex;padding:24px 0}.member-container .avatar{flex:0 1 160px}.avatar img{border-radius:50%;width:100%}.member-container .summary{flex:1 1;margin-left:32px}.member-container{display:block}.member-container .avatar{display:block;margin:0 auto;max-width:300px;width:50%}.member-container .summary{font-size:12px;margin-left:0;text-align:center}.member-container .summary .name{font-size:28px;font-weight:100;margin-top:18px}.member-container .summary .description{font-weight:100;margin-top:8px}.tiny-header{color:#212b36;font-size:16px;font-weight:700}.gatsby-highlight{padding:0;width:95%}.gatsby-highlight pre[class*=language-]{box-sizing:border-box;padding:16px}@media (max-width:30em){.gatsby-highlight{width:100%}}</style><link rel="icon" href="/favicon-32x32.png?v=8d8fa298b67e447760210d9e8b28e447" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=8d8fa298b67e447760210d9e8b28e447"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=8d8fa298b67e447760210d9e8b28e447"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=8d8fa298b67e447760210d9e8b28e447"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=8d8fa298b67e447760210d9e8b28e447"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=8d8fa298b67e447760210d9e8b28e447"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=8d8fa298b67e447760210d9e8b28e447"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=8d8fa298b67e447760210d9e8b28e447"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=8d8fa298b67e447760210d9e8b28e447"/><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl+'';f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer', 'G-7M8K7EBEDX');</script><link rel="alternate" type="application/rss+xml" title="aryumka.me" href="/feed.xml"/></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=G-7M8K7EBEDX" height="0" width="0" style="display: none; visibility: hidden" aria-hidden="true"></iframe></noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><h1 id="di는-왜-필요할까"><a href="#di는-왜-필요할까">DI는 왜 필요할까</a></h1>
<h2 id="개요"><a href="#개요">개요</a></h2>
<p><span><code class="language-text">DI</code></span>는 의존관계 주입(Dependency Injection)의 줄임말으로 객체지향 디자인패턴 중 하나이다.
객체지향 프로그램 내 객체들은 다양한 생명주기를 가지며 서로 상호작용하고 다양한 형태의 의존관계를 갖게 된다.</p>
<blockquote>
<p><strong>Dependency?</strong>
의존관계 혹은 의존성. Dependency를 직역하면 의존성이기도 하고 흔히 이렇게 불리고 있지만 의존관계라는 표현이 더 의미전달에 맞다고 생각하여 (토비의 스프링 참조) 의존관계로 표현한다.</p>
</blockquote>
<p>코드를 예시로 살펴보자. 아래와 같은 프로그램이 있을 때,</p>
<span><div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
	<span class="token class-name">Toy</span> toy<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token class-name">Toy</span> toy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">this</span><span class="token punctuation">.</span>toy <span class="token operator">=</span> toy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Toy</span> <span class="token punctuation">{</span>
	<span class="token comment">/*...*/</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Doll</span> <span class="token keyword">implements</span> <span class="token class-name">Toy</span> <span class="token punctuation">{</span>
	<span class="token comment">/*...*/</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p><span><code class="language-text">Dog</code></span>는 <span><code class="language-text">Toy</code></span>에 의존관계를 갖고있다. 이제 <span><code class="language-text">Doll</code></span>객체를 받아 <span><code class="language-text">Dog</code></span>객체를 생성하려면 어떻게 해야 할까?</p>
<span><div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token class-name">Toy</span> doll <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Doll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Dog</span> cuteDog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>doll<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div></span>
<p><span><code class="language-text">Toy</code></span>객체를 직접 생성, <span><code class="language-text">Dog</code></span>객체가 생성될 때 직접적으로 <span><code class="language-text">Doll</code></span>와 의존관계를 맺을수도 있고</p>
<span><div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token comment">/* 외부 모듈 Injector에 의해 의존관계 주입 */</span>
<span class="token comment">/* Config에 Dog와 Doll의 의존관계가 미리 설정되어 있다고 가정한다.*/</span>
<span class="token class-name">Injector</span> injector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Injector</span><span class="token punctuation">(</span><span class="token class-name">Config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Dog</span> cuteDog <span class="token operator">=</span> injector<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Dog</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></code></pre></div></span>
<p>외부모듈에 의해 미리 생성된 의존관계를 공급받아 객체를 생성하기도 한다. 후자와 같은 형태를 <span><code class="language-text">DI</code></span> 패턴이라고 한다.</p>
<p>그림으로 나타내면 아래와 같다.</p>
<figure><img src="https://velog.velcdn.com/images/aryumka/post/7f996a48-7da4-4a94-acd1-336eae84403e/image.png" style="cursor:default"/></figure>
<figure><img src="https://velog.velcdn.com/images/aryumka/post/0dbb415c-8d11-4398-bb95-7ffec7122e44/image.png" style="cursor:default"/></figure>
<p>의존관계 <strong>주입</strong>이라는 말에서 알 수 있듯 DI 패턴에서는 객체 <strong>외부의 다른 객체 또는 모듈</strong>이 객체 생성 및 의존관계 설정을 담당한다.
<strong>마치 블록을 조립할 때 블록이 아닌 조립하는 사람이 완성된 모양을 결정하는 것처럼 말이다.</strong></p>
<h2 id="dipdependency-inversion-principle-의존관계-역전-원칙"><a href="#dipdependency-inversion-principle-의존관계-역전-원칙">DIP(Dependency Inversion Principle): 의존관계 역전 원칙</a></h2>
<p>객체가 자신의 의존관계를 직접 설정하지 않도록 하는 이유가 뭘까?
객체지향 원칙인 **<span><code class="language-text">SOLID</code></span>**를 살펴보자.</p>
<blockquote>
<p><strong>S</strong>: 단일 책임 원칙 (Single responsibility principle) - 한 클래스는 하나의 책임만 가져야 한다.
<strong>O</strong>: 개방-폐쇄 원칙 (Open/closed principle) - “소프트웨어 요소는 확장에는 열려 있으나 변경에는 닫혀 있어야 한다.”
<strong>L</strong>: 리스코프 치환 원칙 (Liskov substitution principle) - “프로그램의 객체는 프로그램의 정확성을 깨뜨리지 않으면서 하위 타입의 인스턴스로 바꿀 수 있어야 한다.” 계약에 의한 설계를 참고하라.
<strong>I</strong>: 인터페이스 분리 원칙 (Interface segregation principle) - “특정 클라이언트를 위한 인터페이스 여러 개가 범용 인터페이스 하나보다 낫다.”
<strong>D</strong>: 의존관계 역전 원칙 (Dependency inversion principle) - 프로그래머는 “추상화에 의존해야지, 구체화에 의존하면 안된다.”
<a href="https://ko.wikipedia.org/wiki/SOLID_(%EA%B0%9D%EC%B2%B4_%EC%A7%80%ED%96%A5_%EC%84%A4%EA%B3%84)" rel="nofollow noopener noreferrer">출처: 위키피디아</a></p>
</blockquote>
<p>이 중 <span><code class="language-text">의존관계 역전 원칙</code></span>을 실행하기 위한 방법 중 하나가 DI 패턴이다.</p>
<p>만약 위의 예시 코드에서 <span><code class="language-text">Dog</code></span>가 주입받는 <span><code class="language-text">Toy</code></span> 객체가 <span><code class="language-text">Doll</code></span>이 아니라 <span><code class="language-text">Bone</code></span>객체로 바뀐다면 어떻게 될까? 직접 의존관계를 설정한 프로그램이라면 아마도 아래와 같이 구체적 코드를 변경해야 할 것이다.</p>
<span><div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token class-name">Toy</span> bone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Dog</span> cuteDog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span>bone<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div></span>
<p>자연스럽게 개방-폐쇄 원칙을 위반하게 된다.</p>
<p>반면 DI 패턴이 적용된 구현코드는 수정이 필요없다. 이미 Dog 타입의 객체는 Toy 타입의 인터페이스에 의존하고 있고 Bone과 Doll은 모두 Toy를 구현하고 있기 때문이다.
고수준 모듈에서 새로운 구현체를 주입하도록 설정<span><code class="language-text">Config</code></span>만 변경해주면 된다.</p>
<p>이런 의존관계를 설정해주는 고수준 모듈을 손쉽게 사용하기 위해 DI 프레임워크를 사용한다.</p>
<h1 id="di-프레임워크"><a href="#di-프레임워크">DI 프레임워크</a></h1>
<figure><img src="https://velog.velcdn.com/images/aryumka/post/7f306d31-a0c8-40e8-91b5-6c791b188a07/image.png" style="cursor:default"/></figure>
<p>객체지향 패러다임을 포함하는 많은 프레임워크들에서 DI를 제공하고 있다.</p>
<p>대표주자로는 자바(또는 코틀린) 기반 어플리케이션 프레임워크인 <span><code class="language-text">Spring</code></span>의 <span><code class="language-text">IoC Container</code></span>가 있다. 자바, 안드로이드, 코틀린 네이티브, 코틀린 멀티플랫폼 등 다양한 환경을 지원하는  DI 프레임워크인 <span><code class="language-text">Koin</code></span>, <span><code class="language-text">Javascript</code></span>에서는 <span><code class="language-text">nest.js</code></span> 등이 DI 프레임워크를 제공한다.
이러한 프레임워크들에서는 메타데이터를 이용, 의존관계를 주입하거나 객체 생성, 초기화, 사용(조회 등), 객체 소멸 같은 객체의 생명주기를 관리하는 역할을 한다.</p>
<p>이러한 프레임워크들의 동작 원리를 이해하기 위해 <span><code class="language-text">Kontainer</code></span>라는 간단한 DI 컨테이너를 만들어보았다.</p>
<h2 id="kontainer-소개"><a href="#kontainer-소개">Kontainer 소개</a></h2>
<p><span><code class="language-text">Kontainer</code></span>는 코틀린으로 작성했다.
<a href="https://github.com/aryumka/kontainer" rel="nofollow noopener noreferrer">https://github.com/aryumka/kontainer</a></p>
<p>메이븐 중앙저장소에 배포되어있다.</p>
<p>상세 내용은 다음과 같다.</p>
<h3 id="1-컨테이너-구조"><a href="#1-컨테이너-구조">1. 컨테이너 구조</a></h3>
<p>컨테이너는 코틀린의 <span><code class="language-text">object</code></span> 클래스를 이용, 싱글톤으로 구현했다.
컨테이너가 갖는 필드들은 다음과 같다.</p>
<ul>
<li>빈들의 메타데이터가 저장되는 <span><code class="language-text">registeredBean</code></span></li>
<li>생성된 빈들이 저장되는 <span><code class="language-text">createdBean</code></span></li>
<li>의존관계 그래프인 <span><code class="language-text">dependencyGraph</code></span></li>
<li>의존관계 그래프의 간선을 저장한 <span><code class="language-text">edges</code></span></li>
<li>각 빈들의 루트 빈의 정보를 저장하는 <span><code class="language-text">rootIndices</code></span>, <span><code class="language-text">rootIdxMap</code></span></li>
</ul>
<blockquote>
<p>여기서 빈은 프레임워크에 의해 관리되는 컴포넌트(인스턴스)이다.
** 컴포넌트와 모듈의 차이: 컴포넌트는 런타임에 동적으로, 모듈은 컴파일 타임에 정적으로 존재한다.</p>
</blockquote>
<h3 id="2-빈-메타데이터-등록"><a href="#2-빈-메타데이터-등록">2. 빈 메타데이터 등록</a></h3>
<p>먼저 <span><code class="language-text">Kontainer</code></span>에게 어떤 인스턴스를 생성해야 하는지, 각 인스턴스들의 의존관계가 어떻게 되는지 등을 알려줘야 한다. 즉 데이터(객체)에 대한 데이터, <strong>메타데이터</strong>를 제공해야 한다.
프로그램을 실행하는 <span><code class="language-text">main</code></span> 함수에서 아래와 같이 빈을 등록한다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> kontainer <span class="token operator">=</span> <span class="token function">Kontainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
kontainer<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>HelloService<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span></code></pre></div></span>
<p><span><code class="language-text">register</code></span> 함수는 코틀린의 <span><code class="language-text">Reflection</code></span> API(리플렉션 설명)를 이용하여 구현하였다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">register</span><span class="token punctuation">(</span>kClass<span class="token operator">:</span> KClass<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	registeredBean<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>kClass<span class="token punctuation">)</span>
	rootIdxMap<span class="token punctuation">[</span>kClass<span class="token punctuation">]</span> <span class="token operator">=</span> registeredBean<span class="token punctuation">.</span>size <span class="token operator">-</span> <span class="token number">1</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>빈을 등록하면 <span><code class="language-text">registeredBean</code></span>에 해당 객체의 메타데이터 <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.reflect/-k-class/" rel="nofollow noopener noreferrer">KClass</a>가 추가된다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">val</span> registeredBean <span class="token operator">=</span> mutableListOf<span class="token operator">&lt;</span>KClass<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//registeredBean: [class context.HelloService]</span></code></pre></div></span>
<p>등록과 동시에 해당 빈의 루트를 저장할 <span><code class="language-text">rootIdxMap</code></span>에 빈이 추가되는 순서대로 인덱스가 부여된다. 이 인덱스는 의존성 그래프를 그릴 때 사용된다.</p>
<p><span><code class="language-text">Kontainer</code></span>에서는 클래스, 생성자, 필드, 메서드 등 객체로써 메타데이터만 저장하지만 일반적인 DI 프레임워크에는 더 넓은 범위의 설정정보가 필요하다.</p>
<p>컴포넌트로써의 속성, 즉 런타임에 프레임워크 내에서 어떻게 사용되는지에 대한 정보도 필요하기 때문이다. 빈의 생명주기를 결정하는 스코프, 인터페이스 사용 시 구현체 선택 정보 등이 이에 해당한다.</p>
<blockquote>
<p>참고로 <span><code class="language-text">Spring</code></span>에서는 프로그램 내 코드 뿐만이 아닌 다양한 외부 설정으로 빈의 메타데이터를 제공할 수 있다.
<span><code class="language-text">.xml</code></span> 또는 <span><code class="language-text">.properties</code></span>와 같  은 설정파일이나 <span><code class="language-text">Groovy</code></span> 스크립트 파일, 코드에 삽입하여 런타임에 설정되도록 하는 <span><code class="language-text">애너테이션</code></span> 등등으로 프로그램 구현 로직과 분리된 다양하고 높은 수준의 추상화가 가능하다. 각 설정마다 다른 <span><code class="language-text">ApplicationContext</code></span> 구현체로 구현된다.</p>
</blockquote>
<h3 id="3-빈-의존관계-설정-및-주입"><a href="#3-빈-의존관계-설정-및-주입">3. 빈 의존관계 설정 및 주입</a></h3>
<p><span><code class="language-text">Kontainer</code></span>에서는 2에서 등록된 각 빈의 <strong>기본 생성자 파라미터</strong>를 통해 의존관계를 파악하며 이를 의존관계 그래프 <span><code class="language-text">dependencyGraph</code></span>로 나타낸다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">val</span> dependencyGraph <span class="token operator">=</span> mutableMapOf<span class="token operator">&lt;</span>KClass<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">,</span> List<span class="token operator">&lt;</span>KClass<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span><span class="token operator">></span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div></span>
<p>이후 생성에 필요한 의존관계를 이 <span><code class="language-text">dependencyGraph</code></span>에서 찾아 생성과 동시에 주입한다.</p>
<p>예를 들어 아래와 같은 의존관계를 갖고 있는 클래스들을 등록 <span><code class="language-text">register</code></span>했다고 가정하자.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">class</span> E
<span class="token keyword">class</span> B
<span class="token keyword">class</span> C
<span class="token keyword">class</span> <span class="token function">D</span><span class="token punctuation">(</span><span class="token keyword">val</span> e<span class="token operator">:</span> E<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token function">A</span><span class="token punctuation">(</span>
	<span class="token keyword">val</span> b<span class="token operator">:</span> B<span class="token punctuation">,</span>
    <span class="token keyword">val</span> c<span class="token operator">:</span> C<span class="token punctuation">,</span>
    <span class="token keyword">val</span> d<span class="token operator">:</span> D
<span class="token punctuation">)</span>
<span class="token keyword">class</span> G
<span class="token keyword">class</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token keyword">val</span> g<span class="token operator">:</span> G<span class="token punctuation">)</span>

<span class="token keyword">val</span> kontainer <span class="token operator">=</span> Kontainer

kontainer<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>A<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
kontainer<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>B<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
kontainer<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>C<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
kontainer<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>D<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
kontainer<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>E<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
kontainer<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>F<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
kontainer<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>G<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span></code></pre></div></span>
<p>다이어그램으로 표현하면 다음과 같다.</p>
<figure><img src="https://velog.velcdn.com/images/aryumka/post/fdeb4985-a8bf-4ca8-9754-1b2f2520d9a5/image.png" style="cursor:default"/></figure>
<p><span><code class="language-text">registeredBean</code></span>의 메타데이터를 참조하여 기본 생성자 파라미터를 가져와 의존관계 그래프 <span><code class="language-text">dependencyGraph</code></span>와 간선정보 <span><code class="language-text">edges</code></span>를 세팅한다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">setDependencyGraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>bean <span class="token keyword">in</span> registeredBean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">val</span> <span class="token keyword">constructor</span> <span class="token operator">=</span> bean<span class="token punctuation">.</span>primaryConstructor<span class="token operator">!!</span>
        <span class="token keyword">val</span> parameters <span class="token operator">=</span> <span class="token keyword">constructor</span><span class="token punctuation">.</span>parameters
        <span class="token keyword">val</span> parameterTypes <span class="token operator">=</span> parameters<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>type<span class="token punctuation">.</span>classifier <span class="token keyword">as</span> KClass<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span> <span class="token punctuation">}</span>
        dependencyGraph<span class="token punctuation">[</span>bean<span class="token punctuation">]</span> <span class="token operator">=</span> parameterTypes
        
        <span class="token keyword">for</span> <span class="token punctuation">(</span>parameter <span class="token keyword">in</span> parameterTypes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        	edges<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">Pair</span><span class="token punctuation">(</span>bean<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>그리고 의존관계 그래프를 탐색하여 순환참조가 발생하는지 확인 한다.
이를 위해 의존관계에서 가장 상단에 있는 루트 노드를 확인한다.
먼저 아래와 같이 자기 자신을 루트 노드로 초기화 해준 후</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">initRootIndices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	rootIndices <span class="token operator">=</span> <span class="token function">IntArray</span><span class="token punctuation">(</span>registeredBean<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> rootIndices<span class="token punctuation">.</span>indices<span class="token punctuation">)</span> rootIndices<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i
<span class="token punctuation">}</span></code></pre></div></span>
<p>간선 정보를 이용, 빈 등록 시 세팅해주었던 <span><code class="language-text">rootIdxMap</code></span>을 함께 이용하여 <span><code class="language-text">UnionFind</code></span> 알고리즘을 통해 순환 참조가 있는지 파악한다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">unionFind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>edge <span class="token keyword">in</span> edges<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> <span class="token punctuation">(</span>parent<span class="token punctuation">,</span> child<span class="token punctuation">)</span> <span class="token operator">=</span> edge
    <span class="token keyword">val</span> parentIndex <span class="token operator">=</span> rootIdxMap<span class="token punctuation">[</span>parent<span class="token punctuation">]</span><span class="token operator">!!</span>
    <span class="token keyword">val</span> childIndex <span class="token operator">=</span> rootIdxMap<span class="token punctuation">[</span>child<span class="token punctuation">]</span><span class="token operator">!!</span>
    
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> rootIndices<span class="token punctuation">.</span>indices<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>rootIndices<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> childIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	      <span class="token keyword">if</span> <span class="token punctuation">(</span>rootIndices<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> rootIndices<span class="token punctuation">[</span>parentIndex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      		<span class="token keyword">throw</span> <span class="token function">CircularDependencyException</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Circular Dependency for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">parent</span></span><span class="token string"> and </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">child</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    	  <span class="token punctuation">}</span>
      rootIndices<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> rootIndices<span class="token punctuation">[</span>parentIndex<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div></span>
<p>순환참조가 탐지되지 않았다면 의존관계 그래프에 담겨있는 메타데이터를 참조해 빈을 생성하고 주입한다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">createBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> rootIndices<span class="token punctuation">.</span>indices<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rootIndices<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token function">createBean</span><span class="token punctuation">(</span>registeredBean<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> dependencyGraph<span class="token punctuation">[</span>registeredBean<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">!!</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//재귀적으로 탐색하여 아무 객체에도 의존하지 않는 것부터 생성</span>
<span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">createBean</span><span class="token punctuation">(</span>parent<span class="token operator">:</span> KClass<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">,</span> children<span class="token operator">:</span>List<span class="token operator">&lt;</span>KClass<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">></span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> children<span class="token punctuation">.</span>indices<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>createdBean<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>simpleName<span class="token operator">!!</span><span class="token punctuation">)</span> <span class="token operator">||</span> createdBean<span class="token punctuation">[</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>simpleName<span class="token operator">!!</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">createBean</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> dependencyGraph<span class="token punctuation">[</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">!!</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	createdBean<span class="token punctuation">[</span>parent<span class="token punctuation">.</span>simpleName<span class="token operator">!!</span><span class="token punctuation">]</span> <span class="token operator">=</span> parent<span class="token punctuation">.</span>primaryConstructor<span class="token operator">!!</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token operator">*</span>children<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> createdBean<span class="token punctuation">[</span>it<span class="token punctuation">.</span>simpleName<span class="token operator">!!</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">toTypedArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></span>
<p>일반적으로 사용되는 DI 프레임워크들의 경우 기본생성자 외에도 다양한 방법의 DI가 가능하다.</p>
<p>생성자가 여러 개일 때 DI 컨테이너가 어떤 생성자를 사용해야 하는지 알려줄 수도 있으며 생성자 주입이 아닌 생성 이후 <span><code class="language-text">setter</code></span> 메서드 등으로 필드 주입을 할수도 있다.</p>
<blockquote>
<p>필드 주입의 경우 생성 시점과 주입 시점이 다르다. 주입시점에 이미 컨테이너 자신이 생성한 빈을 가져와 주입하며 이 때 주입될 빈이 생성되지 않았다면  <span><code class="language-text">NullPointerException</code></span>가 발생한다. 순환참조 관계를 미리 알 수 없으므로 어플리케이션 실행 중 순환참조 문제가 발생할 수도 있다. <span><code class="language-text">Spring</code></span>의 경우 공식적으로 생성자 주입을 권장하고 있다.</p>
</blockquote>
<h3 id="4-생명주기-관리"><a href="#4-생명주기-관리">4. 생명주기 관리</a></h3>
<p><span><code class="language-text">Kontainer</code></span>에서는 <span><code class="language-text">start</code></span> 메서드를 통해 모든 빈을 일괄적으로 생성하고 <span><code class="language-text">end</code></span> 메서드를 통해 모든 빈을 삭제한다. 이외의 별도의 생명주기 관리는 없다.</p>
<p>일반적인 DI 프레임워크들에서는 단순한 객체 생성 및 의존관계 주입뿐만이 아닌 초기화 또는 파괴(destruct)와 그에 따른 콜백 실행 등 전체 생명주기를 관리한다.</p>
<p>이러한 생명주기는 각 빈의 스코프에 따라 달라질 수 있다.
<span><code class="language-text">Kontainer</code></span>에서는 오직 싱글톤 인스턴스만 등록할 수 있지만 일반적인 프레임워크들에서는 객체의 목적에 따라 다양한 스코프의 빈을 지원하기도 한다.</p>
<blockquote>
<p><span><code class="language-text">Spring</code></span>의 경우 singleton, prototype, request, session, application, websocket <a href="https://docs.spring.io/spring-framework/reference/core/beans/factory-scopes.html" rel="nofollow noopener noreferrer">총 6개의 스코프</a>를 지원한다.
<span><code class="language-text">Koin</code></span>의 경우 <a href="https://insert-koin.io/docs/reference/koin-core/scopes" rel="nofollow noopener noreferrer">커스텀 스코프</a>를 만들어서 사용할 수 있다.</p>
</blockquote>
<h3 id="5-빈-사용"><a href="#5-빈-사용">5. 빈 사용</a></h3>
<p><span><code class="language-text">Kontainer</code></span>에서는 컨테이너 생성 후 등록한 빈을 아래와 같이 가져와 사용한다.</p>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">val</span> kontainer <span class="token operator">=</span> Kontainer
kontainer<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>HelloService<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
kontainer<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>HelloDao<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span>
kontainer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">val</span> bean <span class="token operator">=</span> kontainer<span class="token punctuation">.</span>getBean<span class="token operator">&lt;</span>HelloService<span class="token operator">></span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"HelloService"</span></span><span class="token punctuation">)</span></code></pre></div></span>
<h2 id="보완하고-싶은-점"><a href="#보완하고-싶은-점">보완하고 싶은 점</a></h2>
<ul>
<li>빈의 이름을 지정하는 <span><code class="language-text">Qualifier</code></span>, 스코프 등 빈에 대한 상세한 설정이 필요하다.</li>
<li>빈 설정을 네이티브 코드가 아닌 다양한 방법으로 지원할 수 있다면 좋겠다. 특히 애너테이션을 통한 빈 설정이 최우선순위.</li>
<li>필드 주입 등 다양한 DI 방법을 추가하고 싶다.</li>
<li>추가된 다양한 DI 방법 및 설정에 따라 추상화된 구조를 만들어야 한다.</li>
<li>컨테이너 내 역할에 따른 객체지향적 설계가 필요하다. 현재는 모든 기능이 단일 클래스 안에 구현되어 있다.</li>
<li>적절한 모듈화가 이루어져야 한다. 예를 들어 빈 등록 같은 설정을 <span><code class="language-text">main</code></span>함수에서 호출하는 것보다는 별도의 설정파일에서 설정, <span><code class="language-text">main</code></span>에서는 이를 참조만 하는 것이 바람직하다.</li>
</ul>
<span><div class="gatsby-highlight" data-language="kotlin"><pre class="language-kotlin"><code class="language-kotlin"><span class="token comment">//koin api 호출 예시</span>
<span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">vararg</span> args <span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// Start Koin</span>
    startKoin <span class="token punctuation">{</span>
        <span class="token function">modules</span><span class="token punctuation">(</span>myModule<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Create MyComponent instance and inject from Koin container</span>
    <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> MyService
<span class="token comment">// 모듈 설정</span>
<span class="token keyword">val</span> myModule <span class="token operator">=</span> module <span class="token punctuation">{</span>
    <span class="token comment">// Define a singleton for MyService</span>
    single <span class="token punctuation">{</span> <span class="token function">MyService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div></span>
<ul>
<li><span><code class="language-text">getBean</code></span> 함수에서 타입 파라미터 이외에도 <span><code class="language-text">name: String</code></span>을 넣어줘야 한다. 중복적이고 불필요한 코드이므로 개선이 필요하다.</li>
</ul>
<h1 id="마치며"><a href="#마치며">마치며</a></h1>
<p>스프링을 처음 배웠을 때의 기억이 아직도 생생하다.
이게 뭔지 또 이걸 왜 써야하는지 머릿속에 물음표만이 가득했다.</p>
<p>이후 실무에서도 숨쉬듯 익숙하게 스프링을 써오면서도 IoC 컨테이너의 동작원리나 근본적인 존재 이유에 대해 생각하면 늘 먹구름이 낀 것처럼 흐릿했다.</p>
<p>직접 DI 컨테이너를 만들어 보고 글로 정리하고 보니 이제야 긴 숙제를 마친 기분이다.</p>
<p>텍스트로만 존재했던 스프링에 대한 파편화된 지식이 이번 경험을 통해 각자의 맥락을 찾아 하나로 연결되어 자리잡을 수 있었다.</p>
<p>당연한 말이지만 세상에 당연히 되는 건 없다.
우리가 사용하는 모든 소프트웨어는 마법같이 태어나 존재하는 것이 아니라 우리가 이해할 수 있는 논리와 설계로 이루어진다. 자료구조와 알고리즘이 그 뼈대가 된다는 것도 이번 기회를 통해 직접 피부로 느낄 수 있었다.</p>
<p>다음 바퀴를 만들 때는 또 무엇을 배울 수 있을지 기대된다.</p></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2024-02-18-reinventing-di-framework/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-9915553ea14a0780858b.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-3665d87634c68be1ffb2.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-dd2a394c7c1fc3b558f8.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-870397ab07cd292a2f0c.js\"],\"component---src-pages-timeline-tsx\":[\"/component---src-pages-timeline-tsx-d236255274f00c1999cb.js\"],\"component---src-posts-2023-03-18-spring-boot-tomcat-mdx\":[\"/component---src-posts-2023-03-18-spring-boot-tomcat-mdx-500ccae1fa965d307bca.js\"],\"component---src-posts-2023-04-10-jsoup-html-parser-mdx\":[\"/component---src-posts-2023-04-10-jsoup-html-parser-mdx-a8a463efe842dc142ffe.js\"],\"component---src-posts-2023-12-24-properties-vs-yaml-mdx\":[\"/component---src-posts-2023-12-24-properties-vs-yaml-mdx-bcde4459a868e0bcda79.js\"],\"component---src-posts-2023-12-25-mysql-date-type-mdx\":[\"/component---src-posts-2023-12-25-mysql-date-type-mdx-703598472e819a685eb8.js\"],\"component---src-posts-2023-12-28-holiday-til-1-mdx\":[\"/component---src-posts-2023-12-28-holiday-til-1-mdx-45fe09018f43250d579c.js\"],\"component---src-posts-2023-12-29-holiday-til-2-mdx\":[\"/component---src-posts-2023-12-29-holiday-til-2-mdx-3b2605acc1263aef52ac.js\"],\"component---src-posts-2023-12-31-holiday-til-3-mdx\":[\"/component---src-posts-2023-12-31-holiday-til-3-mdx-dbe62af99710d8a21f7c.js\"],\"component---src-posts-2024-01-02-holiday-til-4-mdx\":[\"/component---src-posts-2024-01-02-holiday-til-4-mdx-a8fcd8a71e11ede56f8b.js\"],\"component---src-posts-2024-01-03-github-actions-mdx\":[\"/component---src-posts-2024-01-03-github-actions-mdx-ff6f090e665e894d55ce.js\"],\"component---src-posts-2024-01-04-til-aws-elastic-ip-docker-mdx\":[\"/component---src-posts-2024-01-04-til-aws-elastic-ip-docker-mdx-6ec573a1cd23a05ca7a9.js\"],\"component---src-posts-2024-01-07-til-practice-tdd-mdx\":[\"/component---src-posts-2024-01-07-til-practice-tdd-mdx-8bc5fbcfaef1fccb3cfb.js\"],\"component---src-posts-2024-01-09-til-kotlin-binary-mdx\":[\"/component---src-posts-2024-01-09-til-kotlin-binary-mdx-b57ad516e1005b30f328.js\"],\"component---src-posts-2024-01-10-til-java-static-block-kotlin-companion-object-mdx\":[\"/component---src-posts-2024-01-10-til-java-static-block-kotlin-companion-object-mdx-30d4540dfe3640f9006a.js\"],\"component---src-posts-2024-01-14-reinventing-big-integer-mdx\":[\"/component---src-posts-2024-01-14-reinventing-big-integer-mdx-b7553ad75b5e7135d845.js\"],\"component---src-posts-2024-01-15-til-resource-mdx\":[\"/component---src-posts-2024-01-15-til-resource-mdx-aa3483e32ee875d24cc6.js\"],\"component---src-posts-2024-01-16-til-gradle-build-error-mdx\":[\"/component---src-posts-2024-01-16-til-gradle-build-error-mdx-00960853c30532d563e1.js\"],\"component---src-posts-2024-01-17-til-kotlin-inline-reflection-mdx\":[\"/component---src-posts-2024-01-17-til-kotlin-inline-reflection-mdx-4031a8b6d545a4d7d4bc.js\"],\"component---src-posts-2024-01-24-query-if-null-return-mdx\":[\"/component---src-posts-2024-01-24-query-if-null-return-mdx-95064dd7cb306229066f.js\"],\"component---src-posts-2024-01-25-kotlin-reflection-mdx\":[\"/component---src-posts-2024-01-25-kotlin-reflection-mdx-5db327b4854369176668.js\"],\"component---src-posts-2024-02-01-jvm-permgen-mdx\":[\"/component---src-posts-2024-02-01-jvm-permgen-mdx-2ae49e740fabe6499c0d.js\"],\"component---src-posts-2024-02-06-real-mysql-mdx\":[\"/component---src-posts-2024-02-06-real-mysql-mdx-4bc0197195356e78b370.js\"],\"component---src-posts-2024-02-07-til-kotlin-sort-mdx\":[\"/component---src-posts-2024-02-07-til-kotlin-sort-mdx-ff927862e57ee292bc8f.js\"],\"component---src-posts-2024-02-18-reinventing-di-framework-mdx\":[\"/component---src-posts-2024-02-18-reinventing-di-framework-mdx-8857f205bb488f98b0b7.js\"],\"component---src-posts-2024-03-02-til-kotlin-jpa-test-mdx\":[\"/component---src-posts-2024-03-02-til-kotlin-jpa-test-mdx-a98012cd8689e66b37ae.js\"],\"component---src-posts-2024-03-03-functional-exception-mdx\":[\"/component---src-posts-2024-03-03-functional-exception-mdx-d35f085a55aa31bf7221.js\"],\"component---src-posts-2024-04-03-til-json-mdx\":[\"/component---src-posts-2024-04-03-til-json-mdx-98c600d896b1354fbb82.js\"],\"component---src-posts-2024-04-22-rabbitmq-seven-patterns-mdx\":[\"/component---src-posts-2024-04-22-rabbitmq-seven-patterns-mdx-242c184d5fc0ac76d993.js\"],\"component---src-posts-2024-05-04-til-test-container-mdx\":[\"/component---src-posts-2024-05-04-til-test-container-mdx-ead019610ee03a38b271.js\"],\"component---src-posts-2024-05-05-til-axon-framework-mdx\":[\"/component---src-posts-2024-05-05-til-axon-framework-mdx-65cbca944c7e364db9a4.js\"],\"component---src-posts-2024-05-12-kafka-axon-eventsourcing-mdx\":[\"/component---src-posts-2024-05-12-kafka-axon-eventsourcing-mdx-d8c6b0d8a17614f5efc7.js\"],\"component---src-posts-2025-04-15-should-exception-be-thrown-mdx\":[\"/component---src-posts-2025-04-15-should-exception-be-thrown-mdx-248ea0aace1bcb3aff12.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-03-18-spring-boot-tomcat-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-03-18-spring-boot-tomcat-mdx-45290e0054343a6b4d5f.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-04-10-jsoup-html-parser-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-04-10-jsoup-html-parser-mdx-6f496c131abe5a301253.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-12-24-properties-vs-yaml-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-12-24-properties-vs-yaml-mdx-8a6ff7652abee5d62d0d.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-12-25-mysql-date-type-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-12-25-mysql-date-type-mdx-9fb9d4edabc5344198a5.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-12-28-holiday-til-1-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-12-28-holiday-til-1-mdx-a8b9a76cc2235b831047.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-12-29-holiday-til-2-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-12-29-holiday-til-2-mdx-155da02f43530036d523.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2023-12-31-holiday-til-3-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2023-12-31-holiday-til-3-mdx-ae29ddb4b41a35c68347.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-01-02-holiday-til-4-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-01-02-holiday-til-4-mdx-86b52db01286c0b43cfc.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-01-03-github-actions-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-01-03-github-actions-mdx-4df5d2cac664e8e77219.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-01-04-til-aws-elastic-ip-docker-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-01-04-til-aws-elastic-ip-docker-mdx-52703dbd33219fcad9cf.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-01-07-til-practice-tdd-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-01-07-til-practice-tdd-mdx-8cdc29761a2c464fe3d0.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-01-09-til-kotlin-binary-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-01-09-til-kotlin-binary-mdx-c3b57937a4515322fec9.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-01-10-til-java-static-block-kotlin-companion-object-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-01-10-til-java-static-block-kotlin-companion-object-mdx-3849c600a4ec858729f0.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-01-14-reinventing-big-integer-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-01-14-reinventing-big-integer-mdx-d16a3029b46e5c103ea6.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-01-15-til-resource-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-01-15-til-resource-mdx-d08a78f905f492a8c3c6.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-01-16-til-gradle-build-error-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-01-16-til-gradle-build-error-mdx-07cb97cbd94cd2e6af08.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-01-17-til-kotlin-inline-reflection-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-01-17-til-kotlin-inline-reflection-mdx-78b07eeea813f267d7c3.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-01-24-query-if-null-return-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-01-24-query-if-null-return-mdx-26a095f81b9977da6a96.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-01-25-kotlin-reflection-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-01-25-kotlin-reflection-mdx-9a816b068686830974f3.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-02-01-jvm-permgen-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-02-01-jvm-permgen-mdx-02c9ee52e433f5d72fd4.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-02-06-real-mysql-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-02-06-real-mysql-mdx-9be7e9682320db1e7d85.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-02-07-til-kotlin-sort-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-02-07-til-kotlin-sort-mdx-b1e8f89d6eae68e05d0f.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-02-18-reinventing-di-framework-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-02-18-reinventing-di-framework-mdx-14186a4f839131115239.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-03-02-til-kotlin-jpa-test-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-03-02-til-kotlin-jpa-test-mdx-52206c245378ad490346.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-03-03-functional-exception-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-03-03-functional-exception-mdx-d7a7c2ecca260f19cfec.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-04-03-til-json-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-04-03-til-json-mdx-6d9e455a8bcc0fda4c8f.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-04-22-rabbitmq-seven-patterns-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-04-22-rabbitmq-seven-patterns-mdx-860bc46678f706156b7c.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-05-04-til-test-container-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-05-04-til-test-container-mdx-f2f6eef82492247f3b5d.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-05-05-til-axon-framework-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-05-05-til-axon-framework-mdx-dc0e757af6d306090a3a.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2024-05-12-kafka-axon-eventsourcing-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2024-05-12-kafka-axon-eventsourcing-mdx-b51c09a08759547fcb1c.js\"],\"component---src-templates-post-tsx-content-file-path-src-posts-2025-04-15-should-exception-be-thrown-mdx\":[\"/component---src-templates-post-tsx-content-file-path-src-posts-2025-04-15-should-exception-be-thrown-mdx-77b06eddc62146bbec72.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="d0b39f40951b8d1987a9";</script><script src="/webpack-runtime-3313ef6726c469650969.js" async></script><script src="/app-9915553ea14a0780858b.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>